
## PROJECT OVERVIEW
This project aims to develop a high-quality PCSS shader for VRChat, compatible with modular avatars and resistant to AutoFIX removal.  The shader will provide improved lighting and shadows within the VRChat environment.  The shader must be compatible with VRCFury's auto-correction features. The shader must maintain functionality even when the avatar is rebuilt.  The project incorporates nadena.dev.modular_avatar.core and nadena.dev.ndmf for robust modular avatar support and AutoFIX resistance, leveraging VRCFury's features for parameter persistence and mirror synchronization where appropriate.  The project structure is organized to improve maintainability and follow Unity best practices.  All scripts must be designed to work seamlessly with modular avatars and resist removal by VRChat's AutoFIX feature. Implementations should leverage VRCFury's features for parameter persistence and mirror synchronization.  The project now utilizes a more organized folder structure to improve maintainability and clarity.  The project is structured to facilitate Modular Avatar compatibility and AutoFIX resistance.  All shaders and scripts are designed for seamless integration with modular avatar systems and to prevent removal by VRChat's AutoFIX feature.

## CODE STYLE
Adhere to C# coding conventions.  Maintain consistent indentation and naming conventions.

## FOLDER ORGANIZATION
The project follows the structure:
```
Assets/
└── PCSS-Shader/
    ├── Scripts/
    │   ├── Core/
    │   │   ├── PCSSLightPlugin.cs        # PCSS中核機能
    │   │   ├── PCSSLightInstaller.cs     # インストーラー
    │   │   └── PCSS.Core.asmdef         # コア機能のアセンブリ定義
    │   └── Utils/
    │       ├── PoissonTools.cs          # ポアソンディスク計算
    │       ├── SetCameraDepth.cs        # カメラ深度設定
    │       └── PCSS.Utils.asmdef         # ユーティリティのアセンブリ定義
    ├── Shaders/
    │   ├── PCSSLiltoonShader.shader    # PCSSシェーダー
    │   └── PCSS.Shaders.asmdef         # シェーダーのアセンブリ定義
    ├── Samples/                         # サンプルシーンとデモ
    ├── Prefabs/                         # プレハブ
    ├── package.json                     # パッケージ情報
    └── README.md                        # ドキュメント

```
This structure groups related files logically, clarifies dependencies, simplifies maintenance, and follows Unity best practices. Assembly Definition files manage dependencies.

## TECH STACK
- Unity
- C#
- VRChat SDK
- nadena.dev.modular_avatar.core (Added 2025-04-04)
- nadena.dev.ndmf (Added 2025-04-04)
- VRCFury (Added 2025-04-04)

## PROJECT-SPECIFIC STANDARDS
- All shader code must be well-commented and easy to understand.
- All scripts must include error handling and logging.
- Compatibility with VRChat's AutoFIX is mandatory. Implementations should leverage VRCFury's features for parameter persistence and mirror synchronization where appropriate.
- Compatibility with VRCFury's auto-correction features is mandatory.
- Code must be designed to maintain functionality across avatar rebuilds.  Utilize MAComponent, MAParameter, and MAMergeAnimator for robust modular avatar support and AutoFIX resistance.  All scripts must be designed to work seamlessly with modular avatars and resist removal by VRChat's AutoFIX feature.  Implementations should leverage VRCFury's features for parameter persistence and mirror synchronization.

## WORKFLOW & RELEASE RULES
- Use Git for version control.
- Follow the GitHub workflow outlined in the `.github` folder.
- Releases should be versioned and documented.

## REFERENCE EXAMPLES
- Refer to the `PCSSLightInstaller.cs`, `PCSSLight.cs`, `PCSSLightPlugin.cs`, and `PCSSLiltoonShader.shader` files for example implementations of modular avatar compatibility and AutoFIX resistance. These files utilize nadena.dev.modular_avatar.core and nadena.dev.ndmf for robust modular avatar support and AutoFIX resistance. Implementations leverage VRCFury's features for parameter persistence and mirror synchronization where appropriate.  `PoissonTools.cs` provides Poisson disk sampling for optimized shadow calculations. `SetCameraDepth.cs` manages camera depth settings for PCSS shadow rendering.

## PROJECT DOCUMENTATION & CONTEXT SYSTEM
- Documentation is maintained in markdown format.
- Version updates will be noted in the relevant sections of this file and the project README.
- Version 1.2.0 (8k support) released (2025-04-04)
- Version 1.2.1 (Modular Avatar & AutoFix Compatibility) released (2025-04-04)
- Version 1.2.2 (Improved Modular Avatar & AutoFix Compatibility) released (2025-04-04)
- Version 1.2.3 (Further Modular Avatar and AutoFix Improvements) released (2025-04-04)
- Version 1.3.0 (Improved Modular Avatar and AutoFix Compatibility, Enhanced Performance) released (2025-04-04)
- Version 1.3.1 (Further Modular Avatar and AutoFix Improvements, Enhanced Performance and Stability) released (2025-04-04)
- Version 1.4.0 (Improved lilToon Integration, Enhanced Modular Avatar Support, and Additional Features) released (2025-04-04)
- Version 1.5.0 (Improved lilToon Integration, Enhanced Modular Avatar Support, and Additional Features, Further Bug Fixes) released (2025-04-04)
- Version 1.6.0 (Improved lilToon Integration, Enhanced Modular Avatar Support, and Additional Features, Further Bug Fixes, Enhanced Stability and Performance) released (2025-04-04)
- Version 1.7.0 (Improved lilToon Integration, Enhanced Modular Avatar Support, Additional Features, Bug Fixes, Enhanced Stability and Performance, Comprehensive Code Refactoring) released (2025-04-04)
- Version 1.8.0 (Modular Avatar and AutoFix improvements, lilToon integration enhancements, performance optimizations, and bug fixes) released (2025-04-04)
- Version 1.9.0 (Further Improvements based on user feedback and AI assistance) released (2025-04-04)
- Version 1.10.0 (Modular Avatar and AutoFix compatibility enhancements, lilToon integration improvements, performance optimizations, bug fixes, and improved documentation) released (2025-04-04)
- Version 1.11.0 (Further improvements based on user feedback and AI assistance, addressing compilation errors and enhancing stability) released (2025-04-04)
- Version 1.12.0 (Further improvements based on user feedback and AI assistance, addressing compilation errors and enhancing stability, improved code structure and modularity) released (2025-04-04)
- Version 1.13.0 (Modular Avatar and AutoFix compatibility enhancements, lilToon integration improvements, performance optimizations, bug fixes, and improved documentation, addressing compilation errors and enhancing stability, improved code structure and modularity, and further improvements based on user feedback and AI assistance) released (2025-04-04)
- Version 1.14.0 (Further improvements based on user feedback and AI assistance, addressing compilation errors and enhancing stability, improved code structure and modularity, and further improvements based on user feedback and AI assistance, addressing compilation errors and enhancing stability, improved code structure and modularity, and further improvements based on user feedback and AI assistance, and additional bug fixes) released (2025/04/04)
- Version 1.15.0 (Further improvements based on user feedback and AI assistance, addressing compilation errors and enhancing stability, improved code structure and modularity, and further improvements based on user feedback and AI assistance, addressing compilation errors and enhancing stability, improved code structure and modularity, and further improvements based on user feedback and AI assistance, and additional bug fixes, and complete code refactoring and restructuring) released (2025/04/04)
- Version 1.16.0 (Modular Avatar and AutoFix compatibility enhancements, lilToon integration improvements, addressing compilation errors and enhancing stability, improved code structure and modularity, and further improvements based on user feedback and AI assistance, and additional bug fixes, and complete code refactoring and restructuring, and additional bug fixes and performance improvements) released (2025/04/04)

## DEBUGGING
Standard Unity debugging techniques should be used.  Log errors and warnings to the console for easier troubleshooting.  Utilize robust error handling and logging within all scripts.

## FINAL DOs AND DON'Ts
- **DO** use the provided code examples as a starting point for development.
- **DO** thoroughly test your code before committing changes, ensuring compatibility with both modular avatars and AutoFIX, as well as VRCFury's auto-correction features and maintaining functionality across avatar rebuilds.
- **DO** ensure compatibility with modular avatars and AutoFIX using MAComponent, MAParameter, and MAMergeAnimator where appropriate.
- **DO** leverage VRCFury's features for enhanced AutoFIX resistance and mirror synchronization.
- **DON'T** commit incomplete or untested code.
- **DON'T** introduce breaking changes without thorough testing and documentation.